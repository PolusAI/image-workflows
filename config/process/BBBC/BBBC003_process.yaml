# polus-plugins workflow definition
# dependencies between steps are defined by links between inputs and outputs
# for each steps and will be appropriately generated by wic.
name: viz_workflow_BBBC003
steps:
    - filerenaming:
        plugin:
            name: "FileRenaming"
            manifest: "https://raw.githubusercontent.com/agerardin/polus-plugins/update/filerenaming_subpath/formats/file-renaming-plugin/plugin.json"
        params:
            inpDir:
                type: Path
                path: "viz_workflow_BBBC003__step__1__BbbcDownload/InpDirFileRenaming/BBBC/BBBC003/raw/Images/"
            mapDirectory: "map"
            filePattern: "{t:d}_{x:dd}_M{y:d}{e:c}{p:d+}.tif"
            outFilePattern: "x{x:dd}_y{y:dd}_p{p:dd}_t{t:dd}.tif"
    - omeconverter:
        plugin:
            name: "OmeConverter"
            manifest: "https://raw.githubusercontent.com/PolusAI/polus-plugins/a2666916628ab8e7d04e87d866f9b7835a86ef55/formats/ome-converter-plugin/plugin.json"
        params:
            inpDir:
                type: Path
                link: FileRenaming.outDir
            filePattern: ".*.tif"
            fileExtension: ".ome.tif"
    - montage:
        plugin:
            name: "Montage"
            manifest: "https://raw.githubusercontent.com/PolusAI/polus-plugins/master/transforms/images/montage-plugin/plugin.json"
        params:
            inpDir:
                type: Path
                link: OmeConverter.outDir
            filePattern: "d1_x20_y03_p{p:dd}_t07.ome.tif"
            layout: "p"
    - image_assembler:
        plugin:
            name: "ImageAssembler"
            manifest: "https://raw.githubusercontent.com/agerardin/polus-plugins/new/image-assembler-plugin-1.4.0-dev0/transforms/images/image-assembler-plugin/plugin.json"
        params:
            imgPath:
                type: Path
                link: OmeConverter.outDir
            stitchPath:
                type: Path
                link: Montage.outDir
    - precompute_slide:
        plugin:
            name: "PrecomputeSlide"
            manifest: "https://raw.githubusercontent.com/agerardin/polus-plugins/update/precompute-slide-fp2/visualization/precompute-slide-plugin/plugin.json"
        params:
            inpDir:
                type: Path
                link: ImageAssembler.outDir
            pyramidType: "Zarr"
            imageType: "image"
            outDir:
                type: Path
                path: "BBBC/BBBC003_out"
